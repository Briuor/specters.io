<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dduel.io</title>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="./camera.js"></script>
    <script src="./map.js"></script>
    <script src="./state.js"></script>
    <script src="./network.js"></script>
    <script src="./render.js"></script>
    <script src="./input.js"></script>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script>
        // Canvas setup
        let canvas = document.getElementById('canvas');
        canvas.style.background = "black"
        let ctx = canvas.getContext('2d');
        canvas.width = 640;
        canvas.height = 320;

        const map = new  Map();
        const camera = new Camera(canvas.width, canvas.height);
        const state = new State();
        const network = new Network();
        const render = new Render();
        const input = new Input(network, camera);

        // Main Loop
        function run() {
            // get update
            const { me, otherPlayers, bullets } = state.getCurrentState();
            if (!me) return;
            camera.follow(me);
            camera.update();
            
            // clear screen
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // draw
            camera.draw(ctx, map);
            render.draw(ctx, me, camera);
            render.drawPlayers(ctx, otherPlayers, bullets, camera);
        }

        Promise.all([network.connect(state)]).then(() => {
            setInterval(run, 1000 / 60);
        });
    </script>
</body>

</html>